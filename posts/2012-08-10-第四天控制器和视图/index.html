<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title> 第四天：控制器和视图 - </title>
  <meta name="description" content="" />
  <meta property="og:title" content="第四天：控制器和视图" />
  <meta name="twitter:title" content="第四天：控制器和视图" />
  <meta name="description" content="目录 4.1 MVC架构 4.2 布局 4.3 CSS样式表、图片、JS脚本 4.4 首页 4.5 行为 4.5.1 模板 4.6 职位页面的模板 4.7 槽 4.8 职位页面的行为 4.9 请求和响应 4.10 请求 4.11 响应 4.12 结语 昨天">
  <meta property="og:description" content="目录 4.1 MVC架构 4.2 布局 4.3 CSS样式表、图片、JS脚本 4.4 首页 4.5 行为 4.5.1 模板 4.6 职位页面的模板 4.7 槽 4.8 职位页面的行为 4.9 请求和响应 4.10 请求 4.11 响应 4.12 结语 昨天">
  <meta name="twitter:description" content="目录 4.1 MVC架构 4.2 布局 4.3 CSS样式表、图片、JS脚本 4.4 首页 4.5 行为 4.5.1 模板 4.6 职位页面的模板 4.7 槽 4.8 职位页面的行为 4.9 请求和响应 4.10 请求 4.11 响应 4.12 结语 昨天">
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="https://www.51hint.com/posts/2012-08-10-%E7%AC%AC%E5%9B%9B%E5%A4%A9%E6%8E%A7%E5%88%B6%E5%99%A8%E5%92%8C%E8%A7%86%E5%9B%BE/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="IT技术分享" />

  <meta name="generator" content="Hugo 0.81.0" />
  <link rel="canonical" href="https://www.51hint.com/posts/2012-08-10-%E7%AC%AC%E5%9B%9B%E5%A4%A9%E6%8E%A7%E5%88%B6%E5%99%A8%E5%92%8C%E8%A7%86%E5%9B%BE/" />
  <link rel="alternate" href="https://www.51hint.com/index.xml" type="application/rss+xml" title="IT技术分享">
  
  
  <script src="https://www.51hint.com/js/jquery-1.12.4.min.js"></script>
  <link rel="stylesheet" href="https://www.51hint.com/css/katex.min.css" />
  <link rel="stylesheet" href="https://www.51hint.com/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://www.51hint.com/css/bootstrap.min.css" />
  
  
  
  <link rel="stylesheet" href="https://www.51hint.com/css/main.css" />
  
  
  
  



<link rel="stylesheet" href="https://www.51hint.com/css/photoswipe.css" />
<link rel="stylesheet" href="https://www.51hint.com/css/default-skin/default-skin.css" />





<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>




<link rel="stylesheet" href="https://www.51hint.com/css/styles/atom-one-dark.css" />
<script src="https://www.51hint.com/js/highlight.pack.js"></script>

<script>hljs.initHighlightingOnLoad();</script>
</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://www.51hint.com/">IT技术分享</a>
    </div>
    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        

        

        
        
          <li>
            <a id="mSearch" href="#modalSearch" data-toggle="modal" data-target="#modalSearch" style="outline: none;">
              <span class="hidden-sm hidden-md hidden-lg">Search</span> <span id="searchGlyph" class="glyphicon glyphicon-search"></span>
            </a>
          </li>
          
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
      </div>
    </div>

  </div>
</nav>







    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-12 col-md-12 col-md-offset-0">
            <div class="post-heading">
                <h1 align="center">第四天：控制器和视图</h1>
                
                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>




<div id="fastSearch">
  <input id="searchInput" tabindex="0">
  <ul id="searchResults">
  </ul>
</div>

<script src="/js/fuse.min.js"></script>
<script src="/js/fastsearch.js"></script>
<link rel="stylesheet" href="https://www.51hint.com/css/fast.css" />
    
<div class="container" role="main" itemscope itemtype="http://schema.org/Article">
    <div class="row">
        <div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1">
            
            
            
<div>
    <section id="datecount">
        <h4 id="date"> Fri Aug 10, 2012</h4>
    </section>
    <h5 id="wc">4500 Words|Read in about 9 Min</h5>
    <h5 id="tags">Tags: 
    </h5>
</div>

            
            <article role="main" class="blog-post" itemprop="articleBody" id="content">
                
  
  <aside class="toc">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#heading">[</a></li>
    <li><a href="#chapter_04_the_layout"><a href="http://php-sf.com/forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.2 布局</a></a></li>
    <li><a href="#chapter_04_the_stylesheets_images_and_javascripts"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.3 CSS样式表、图片、JS脚本</a></a></li>
    <li><a href="#chapter_04_the_job_homepage"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.4 首页</a></a></li>
    <li><a href="#chapter_04_sub_the_action"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.5 行为</a></a>
      <ul>
        <li><a href="#chapter_04_sub_the_template"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.5.1 模板</a></a></li>
      </ul>
    </li>
    <li><a href="#chapter_04_the_job_page_template"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.6 职位页面的模板</a></a></li>
    <li><a href="#chapter_04_slot_s"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.7 槽</a></a></li>
    <li><a href="#chapter_04_the_job_page_action"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.8 职位页面的行为</a></a></li>
    <li><a href="#chapter_04_the_request_and_the_response"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.9 请求和响应</a></a></li>
    <li><a href="#chapter_04_sub_the_request"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.10 请求</a></a></li>
    <li><a href="#chapter_04_sub_the_response"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.11 响应</a></a></li>
    <li><a href="#chapter_04_final_thoughts"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.12 结语</a></a></li>
  </ul>
</nav>
  </aside>
  


                <ul>
<li>目录</li>
<li><a href="http://php-sf.com/forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#chapter_04_the_mvc_architecture">4.1 MVC架构</a></li>
<li><a href="http://php-sf.com/forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#chapter_04_the_layout">4.2 布局</a></li>
<li><a href="http://php-sf.com/forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#chapter_04_the_stylesheets_images_and_javascripts">4.3 CSS样式表、图片、JS脚本</a></li>
<li><a href="http://php-sf.com/forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#chapter_04_the_job_homepage">4.4 首页</a></li>
<li><a href="http://php-sf.com/forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#chapter_04_sub_the_action">4.5 行为</a></li>
<li><a href="http://php-sf.com/forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#chapter_04_sub_the_template">4.5.1 模板</a></li>
<li><a href="http://php-sf.com/forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#chapter_04_the_job_page_template">4.6 职位页面的模板</a></li>
<li><a href="http://php-sf.com/forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#chapter_04_slot_s">4.7 槽</a></li>
<li><a href="http://php-sf.com/forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#chapter_04_the_job_page_action">4.8 职位页面的行为</a></li>
<li><a href="http://php-sf.com/forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#chapter_04_the_request_and_the_response">4.9 请求和响应</a></li>
<li><a href="http://php-sf.com/forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#chapter_04_sub_the_request">4.10 请求</a></li>
<li><a href="http://php-sf.com/forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#chapter_04_sub_the_response">4.11 响应</a></li>
<li><a href="http://php-sf.com/forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#chapter_04_final_thoughts">4.12 结语</a></li>
<li></li>
</ul>
<p>昨天，我们研究了symfony如何通过抽象数据库引擎之间的差异来简化数据库管理，然后通过转换关系元素到面向对象的类。我们描述了数据库schema、创建表、填充一些初始数据到数据库。</p>
<p>今天，我们要定制我们先前创建的基本的 <code>job</code> 模块。<code>job</code> 模块已经有Jobeet所需全部代码：</p>
<ul>
<li>一个页面来列出所有的职位；</li>
<li>一个页面来创建一个新的职位；</li>
<li>一个页面来更新一个已存在的职位；</li>
<li>一个页面来删除一个职位；</li>
</ul>
<p>尽管代码可以使用了，我会重构模板来接近Jobeet样稿。</p>
<h2 id="heading">[</h2>
<p>4.1 MVC架构]<a href="http://php-sf.com/forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">14</a>{#chapter_04_the_mvc_architecture}</p>
<p>如果你开发PHP网站没有使用框架，你大概用一个PHP文件来作为每个HTML页面范式。这些PHP文件大概包含相同种类的结构：初始化、全局配置、业务逻辑相关的请求的页面、数据库记录提取，和最后的HTML代码构建网页。</p>
<p>你可以用一个模板引擎来分离HTML中的逻辑。也许你用一个数据库抽象层来分离业务逻辑中的模型交互，但大多数时候，你有很多代码，其维护是一场噩梦。它构建速度快，但随着时间推移，越来越难修改，尤其是除你以外，没有人理解它是如何构成的和它是如何工作的。</p>
<p>至于种种问题，有很好的解决方案。对于WEB开发，最常见的解决方案是组织你的代码成<strong>MVC设计模式</strong>。简而言之，MVC设计模式根据其性质定义一种方式来组织你的代码。这个模式把代码分离为<strong>三层</strong>：</p>
<ul>
<li>**模型（Model）**层定义业务逻辑（数据库属于这一层）。你已经知道symfony储存所有的类和文件相关模型在 <code>lib/model/</code> 目录；</li>
<li>**视图（View）**层与用户交互（模板引擎是这一层的一部分）。在symfony中，视图层主要是由PHP模板组成。他们储存在不同的 <code>templates/</code> 目录中；</li>
<li><strong>控制器（Controller）<strong>层是一些代码，这些代码调用模型取得一些数据，然后传递到视图呈现到客户端。在本教程的开始我们安装symfony的时候，我们看到所有请求通过前端控制器来管理（<code>index.php</code> 和 <code>frontend_dev.php</code>）。前端控制器代表真正工作的</strong>行为</strong>。正如我们前面所看到的，这些行为按逻辑被分组成<strong>模块</strong>。</li>
</ul>
<p> </p>
<p>今天，我们会使用在第二天定制的首页和职位页面样稿。我们将会使它变为动态。一路上，我们会在许多不同的文件调整许多东西，并展示symfony目录结构和层与层之间的代码分离。</p>
<h2 id="chapter_04_the_layout"><a href="http://php-sf.com/forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.2 布局</a></h2>
<p>首先，如果你仔细看了样稿，你会注意到每个页面有太多地方是相同的。重复代码是不良习惯你是知道的，而无论是HTML还是PHP代码，因此我们需要找到一种方式来防止这些公共视图元素造成代码重复。</p>
<p>一种解决问题方式是定义一个页头和一个页脚并将他们包含在每个模板中：</p>
<p>但是这里的页头文件和页脚文件不能包含完整的HTML代码。必须有一个更好的方法，而不是制造重复的轮子。我们会用另一种设计模式来解决这个问题：<a href="http://en.wikipedia.org/wiki/Decorator_pattern">装饰设计模式（decorator design pattern）</a>。装饰设计模式用其他方法解决了问题：模板内容是一个全局模板来装饰呈现的，在symfony中叫做<strong>布局</strong>。</p>
<p>一个应用的默认布局是 <code>layout.php</code>，可以在 <code>apps/frontend/templates/</code> 目录中找到。</p>
<p>用下面的代码替换默认的symfony布局：</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>一个symfony模板仅仅是一个纯PHP文件。在布局模板中，你可以调用PHP函数和应用PHP变量。<code>$sf_content</code> 是最有趣的变量：它是由框架本身定义的，并且包含行为产生的HTML。</p>
<p>如果浏览 <code>job</code> 模块（<!-- raw HTML omitted --><a href="http://www.jobeet.com.localhost/frontend_dev.php/job">http://www.jobeet.com.localhost/frontend_dev.php/job</a><!-- raw HTML omitted -->），会看到所有的行为现在都是布局装饰的。</p>
<h2 id="chapter_04_the_stylesheets_images_and_javascripts"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.3 CSS样式表、图片、JS脚本</a></h2>
<p>由于本教程不是关于网页设计的，我已经准备了所有Jobeet所需要用到的素材：<a href="http://www.symfony-project.org/get/jobeet/images.zip">下载图片文件</a>存档并把它们放进 <code>web/images/</code> 目录中；<a href="http://www.symfony-project.org/get/jobeet/css.zip">下载CSS样式表文件</a>存档并把它们放进 <code>web/css/</code> 目录中。</p>
<!-- raw HTML omitted -->
<p><img src="res/job_layout_assets.png" alt="职位模板的布局和素材"></p>
<!-- raw HTML omitted -->
<p>细心的读者会注意到，即使 <code>main.css</code> 文件没有在默认模板中任何地方提及，但它又是生成在了HTML代码中。这怎么可能？</p>
<p>CSS样式表文件已在调用 <code>include_stylesheets()</code> 函数时所包含。<code>include_stylesheets()</code> 函数称为<strong>助手</strong>。助手是symfony定义的一个函数，可以带参数并返回HTML代码。大多数时候，助手是节省时间的，它们打包模板中频繁使用的代码。对于CSS样式表 <code>include_stylesheets()</code> 助手生成CSS样式表的 <code>&lt;link&gt;</code> 标签。</p>
<p>但助手如何知道调用哪个CSS样式表？</p>
<p>编辑应用的配置文件 <code>view.yml</code> 视图层助手是可以编辑的。下面是 <code>generate:app</code> 命令默认生成的：</p>
<pre><code># apps/frontend/config/view.yml
default:
  http_metas:
    content-type: text/html
 
  metas:
    #title:        symfony project
    #description:  symfony project
    #keywords:     symfony, project
    #language:     en
    #robots:       index, follow
 
  stylesheets:    [main.css]
 
  javascripts:    []
 
  has_layout:     true
  layout:         layout
</code></pre>
<p>对于应用的所有模板编辑 <code>view.yml</code> 文件配置 <code>default</code> 设置。例如，对于应用的每个页面则 <code>stylesheets</code> 这行定义一个CSS样式表文件的数组来调用（列入其则由 <code>include_stylesheets()</code> 助手完成）。</p>
<!-- raw HTML omitted -->
<p>如果在许多文件中定义了，symfony会已相同的定义顺序调用它们：</p>
<pre><code>stylesheets: [main.css, jobs.css, job.css]
</code></pre>
<p>你也能更改 <code>media</code> 属性忽略其前缀：</p>
<pre><code>stylesheets: [main.css, jobs.css, job.css, print: { media: print }]
</code></pre>
<p>这个配置会呈现为：</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>但仅仅只有首页和职位页面需要 <code>jobs.css</code> 文件。<code>view.yml</code> 配置文件可以在每个模块基础上自定义，仅仅只包含 <code>main.css</code> 则更改应用的 <code>view.yml</code> 文件的 <code>stylesheets</code> 键：</p>
<pre><code># apps/frontend/config/view.yml
stylesheets:  [main.css]
</code></pre>
<p>如果要定制 <code>job</code> 模块的试图，则创建一个 <code>view.yml</code> 文件在 <code>apps/frontend/modules/job/config/</code> 目录中：</p>
<pre><code>#apps/frontend/module/job/config/view.yml
indexSuccess:
  stylesheets: [jobs.css]
  
showSuccess:
  stylesheets: [job.css]
</code></pre>
<p>在 <code>indexSuccess</code> 和 <code>showSuccess</code> 条目下（它们是 <code>index</code> 和 <code>show</code> 行为的相关模板，正如我们稍后要看到的），你可以找到在应用的 <code>view.yml</code> 中的 <code>default</code> 条目下定义一些条目。所有特定的条目会合并为应用的配置。你也可以用 <code>all</code> 条目对一个模块的所有行为定义一些配置。</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>作为一个经验法则，当某些东西可以通过配置文件配置，同样可以实现PHP代码。而不是对 <code>job</code> 模块创建一个 <code>view.yml</code> 的实例，你也可以用 <code>use_stylesheet()</code> 助手从模板来调用CSS样式表：</p>
<pre><code>&lt;php use_stylesheet('main.css'); ?&gt;
</code></pre>
<p>你也可以用这个助手在布局中来调用一个全局性的CSS样式表。</p>
<p>在几个方法之间做选择，确实是个品味问题。对于模型的所有行为 <code>wiew.yml</code> 文件提供一个方法来定义，另一方面，使用 <code>use_stylesheet()</code> 助手是更灵活的，都是在一个地方：CSS样式表的定义和HTML代码。对于Jobeet，我们会用 <code>use_stylesheet()</code> 助手，因此你可以删除我们刚才创建的 <code>view.yml</code>，然后更新 <code>job</code> 模板用 <code>use_stylesheet()</code> 调用：</p>
<pre><code>&lt;!-- apps/frontend/modules/job/templates/indexSuccess.php --&gt;
&lt;?php use_stylesheet(&lt;span class=&quot;st0&quot;&gt;'jobs.css'&lt;/span&gt;) ?&gt;

&lt;!-- apps/frontend/modules/job/templates/showSuccess.php --&gt;
&lt;?php use_stylesheet(&lt;span class=&quot;st0&quot;&gt;'job.css'&lt;/span&gt;) ?&gt;
</code></pre>
<!-- raw HTML omitted -->
<h2 id="chapter_04_the_job_homepage"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.4 首页</a></h2>
<p>正如在<!-- raw HTML omitted -->第三天<!-- raw HTML omitted -->所看到的，首页是 <code>job</code> 模块的 <code>index</code> 行为产生的。<code>index</code> 行为是控制器的一部分，还有模板 <code>indexSuccess.php</code> 是视图的一部分：</p>
<pre><code>apps/
  frontend/
    module/
      job/
        actions/
          actions.class.php
        templates/
          indexSuccess.php
</code></pre>
<h2 id="chapter_04_sub_the_action"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.5 行为</a></h2>
<p>每个行为是代表一个类的方法。对于首页，类是 <code>jobActions</code> （模块的名字前缀是 <code>Actions</code>）和方法是 <code>executeIndex()</code> （<code>execute</code> 是方法名字的后缀）。从数据库检索所有职位：</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>我们来仔细看看代码：<code>executeIndex()</code> 方法（控制器）调用 <code>JobeetJob</code> 表来创建一个查询来检索所有职位。它返回一个 <code>JobeetJob</code> 的 <code>Doctrine_Collection</code> 对象并被赋予给 <code>jobeet_jobs</code> 对象属性。所有这些对象属性然后自动传递给模板（视图）。传递数据从控制器到视图，只需创建一个新的属性：</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>这个代码会使 <code>$foo</code> 和 <code>$bar</code> 变量可以在模板中可以被访问。</p>
<h3 id="chapter_04_sub_the_template"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.5.1 模板</a></h3>
<p>默认情况下，symfony自动推断出与动作相关联的模板名字，这是因为命名规则的缘故（行为名字后缀加 <code>Success</code>）。</p>
<p>对于所有职位 <code>indexSuccess.php</code> 模板生成一个HTML表格。其模板代码是：</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>在模板代码中，<code>foreach</code> 循环一列 <code>Job</code> 对象（<code>$jobeet_jobs</code>），输出每个 <code>Job</code>与每个字段值。记住，访问一个字段值很简单，只要调用一个访问器方法，名字开头用 <code>get</code> 并加上驼峰式的字段名（例如对于 <code>created_at</code> 字段则为 <code>getCreateAt()</code> 方法）。</p>
<p>我们清理一下，只显示一小组可用的字段：</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><img src="res/homepage.png" alt="首页"></p>
<p>在这个模板中调用的 <code>url_for()</code> 函数是一个symfony助手，我们会在明天讨论。</p>
<h2 id="chapter_04_the_job_page_template"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.6 职位页面的模板</a></h2>
<p>现在我们来定制职位页面的模板。打开 <code>showSuccess.php</code> 文件然后用下面的代码替换之：</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>这个模板使用行为传递来的 <code>$job</code> 变量来显示职位信息。正如我们重命名变量从 <code>$jobeet_job</code> 到 <code>$job</code> 传递给模板，在 <code>show</code> 行为中你还需要进行更改（要小心，有两个变量出现）：</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>注意日期字段可以被转换为PHP的 <code>DateTime</code> 对象实例。正如我们定义了 <code>created_at</code> 字段作为一个时间戳，你可以用 <code>getDateTimeObject()</code> 方法将字段值转换为 <code>DateTime</code> 对象，然后调用 <code>format()</code> 方法，带一个日期格式作为第一个参数：</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><img src="res/job_html.png" alt="职位页面"></p>
<h2 id="chapter_04_slot_s"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.7 槽</a></h2>
<p>所有页面的标题是定义在布局的 <code>&lt;title&gt;</code> 标签中：</p>
<pre><code>&lt;title&gt;Jobeet - Your best job board&lt;/title&gt;
</code></pre>
<p>但对于职位页面，我们要提供更多有用的信息，像公司名称和工作地点。</p>
<p>在symfony中，当一个区域的布局取决于要显示的模板，你需要定义一个槽：</p>
<p><img src="res/layout_slots.png" alt="槽"></p>
<p>添加一个槽到布局来让标题成动态的：</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>每个槽定义一个名字（<code>title</code>）并且可以用 <code>include_slot()</code> 助手来显示。现在，在 <code>showSuccess.php</code> 模板的开始，用 <code>slot()</code> 助手来定义职位页面槽的内容：</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>如果标题很复杂，<code>slot()</code> 助手也可以用一个代码块：</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>对于一些页面，像首页，我们只需要一个通用的标题。而不是一遍又一遍的在模板中重复相同的标题，我们可以定义一个默认标题在布局中：</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><code>include_slot()</code> 方法的第二个参数是槽的默认值。如果默认值太长或者包含一些HTML标签，你也可以像下面这样定义：</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>如果当槽已被定义，<code>include_slot()</code> 助手则返回 <code>true</code>。因此，当你在模板中定义了 <code>title</code> 槽的内容，则槽内容是可用的；如果没有定义，则槽默认值是可用的。</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="chapter_04_the_job_page_action"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.8 职位页面的行为</a></h2>
<p>职位页面由 <code>show</code> 行为生成，在 <code>job</code> 模块的 <code>executeShow()</code> 方法中定义：</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>正如在 <code>index</code> 行为中，<code>JobeetJob</code> 表的类是用于检索职位的，这个时候用 <code>find()</code> 方法。方法的参数是一个职位的唯一标示符，它是主键下一节会解释为什么 <code>$request-&gt;getParameter('id')</code> 语句返回职位主键。</p>
<p>如果职位在数据库中不存在，我们要转发给用户一个404页面，这正是 <code>forward404Unless()</code> 方法所要做的。它带一个布尔值作为其第一个参数，如果不是 <code>true</code>，则会停止当前的执行过程。由于转发方法停止行为的执行并立即抛出一个 <code>sfError404Exception</code>，你不需要返回以后。</p>
<p>例外情况，在 <code>prod</code> 环境和 <code>dev</code> 环境中向用户显示的页面是不同的：</p>
<p><img src="res/404_dev.png" alt="在开发环境中的404错误"></p>
<p><img src="res/404_prod.png" alt="在生产环境中的404错误"></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="chapter_04_the_request_and_the_response"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.9 请求和响应</a></h2>
<p>当你在浏览器中浏览 <code>/job</code> 或 <code>/job/show/id/1</code> 页面，你是在与Web服务器发起一个来回。浏览器发送<strong>请求</strong>到服务器并返回<strong>响应</strong>。</p>
<p>我们已经看到，symfony把请求封装在一个 <code>sfWebRequest</code> 对象中（见 <code>executeShow()</code> 方法）。而symfony作为面向对象的框架，响应也是一个对象，<code>sfWebResponse</code> 类。你可以在一个行为中调用 <code>$this-&gt;getResponse()</code> 访问响应对象。</p>
<p>这些对象提供许多方便的方法来访问PHP函数和PHP全局变量的信息。</p>
<!-- raw HTML omitted -->
<h2 id="chapter_04_sub_the_request"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.10 请求</a></h2>
<p><code>sfWebRequest</code> 类包装了 <code>$_SERVER, $_COOKIE, $_GET, $_POST, $_FILES</code> PHP全局数组：</p>
<!-- raw HTML omitted -->
<pre><code>&lt;th&gt;
  PHP等效的
&lt;/th&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;$_SERVER['REQUEST_METHOD']&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;$_SERVER['REQUEST_URI']&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;$_SERVER['HTTP_REFERER']&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;$_SERVER['HTTP_HOST']&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;$_SERVER['HTTP_ACCEPT_LANGUAGE']&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;$_SERVER['HTTP_ACCEPT_CHARSET']&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;$_SERVER['X_REQUESTED_WITH'] == 'XMLHttpRequest'&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;$_SERVER&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;$_COOKIE&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;$_SERVER['HTTPS']&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;$_FILES&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;$_GET&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;$_POST&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;$_SERVER['PATH_INFO']&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;$_SERVER['REMOTE_ADDR']&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<p>我们已经用 <code>getParameter()</code> 方法访问了请求参数。它从 <code>$_GET</code> 或 <code>$_POST</code> 变量返回一个值，或从 <code>PATH_INFO</code> 变量。</p>
<p>如果你要确保一个请求参数来自这些变量中一个具体的，你需要用 <code>getGetParameter()</code>，<code>getPostParameter()</code>，和 <code>getUrlParameter()</code> 方法。</p>
<!-- raw HTML omitted -->
<h2 id="chapter_04_sub_the_response"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.11 响应</a></h2>
<p><code>sfWebResponse</code> 类包装了 <code>header()</code> 和 <code>setrawcookie()</code> PHP函数：</p>
<!-- raw HTML omitted -->
<pre><code>&lt;th&gt;
  PHP等效的
&lt;/th&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;setrawcookie()&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;header()&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;header()&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;header()&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;header()&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;td&gt;
  &lt;code&gt;header()&lt;/code&gt;
&lt;/td&gt;
</code></pre>
<!-- raw HTML omitted -->
<p>当然，<code>sfWebResponse</code> 类也提供一个方法来设置响应的内容（<code>setContent()</code>）和发送响应到浏览器（<code>send()</code>）。</p>
<p>今天的早些时候，我们看到了如何在 <code>view.yml</code> 文件和模板中管理CSS样式表和JS脚本。在最后，两种方法都使用响应对象 <code>addStylesheet()</code> 和 <code>addJavascript()</code> 方法。</p>
<!-- raw HTML omitted -->
<h2 id="chapter_04_final_thoughts"><a href="forum.php?mod=viewthread&amp;tid=20&amp;extra=page%3D1#">4.12 结语</a></h2>
<p>今天，我们描述了symfony使用的一些设计模式。希望项目的目录结构现在更有意义。我们了解了操纵布局和模板文件。我们用槽和行为也使它们多一点动态性。</p>
<p>明天，我们会使用 <code>url_for()</code> 助手，和有关路由。</p>

            </article>

            <ul class="pager blog-pager">
                
                <li class="previous">
                    <a href="https://www.51hint.com/posts/2012-08-10-symfony1-4-%E4%B8%AD%E6%96%87%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B-%E7%AC%AC%E4%BA%8C%E5%A4%A9%E7%94%A8%E6%88%B7%E9%9C%80%E6%B1%82/" data-toggle="tooltip" data-placement="top" title="第二天：用户需求">&larr; Previous Post</a>
                </li>
                 
                <li class="next">
                    <a href="https://www.51hint.com/posts/2012-08-10-%E7%AC%AC%E4%BA%94%E5%A4%A9%E8%B7%AF%E7%94%B1/" data-toggle="tooltip" data-placement="top" title="第五天：路由">Next Post &rarr;</a>
                </li>
                
            </ul>
            
            <div>
                 
            </div>
            
            
            
            
<div>
    <section id="datecount">
        <h4 id="date"> Fri Aug 10, 2012</h4>
    </section>
    <h5 id="wc">4500 Words|Read in about 9 Min</h5>
    <h5 id="tags">Tags: 
    </h5>
</div>

            
            </div>
            
            
        </div>
    </div>
    </section>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
        
          
          
        </ul>
        <p class="credits copyright text-muted">
        &copy;2017-2018
          
          
          
            &nbsp;&bull;&nbsp;
            <a href="https://www.51hint.com/">IT技术分享</a>
          
        </p>
        <p class="credits theme-by text-muted">
          
        </p>

        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.81.0</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/rootsongjc/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>




<script src="https://www.51hint.com/js/bootstrap.min.js"></script>
<script src="https://www.51hint.com/js/photoswipe-ui-default.min.js"></script>
<script src="https://www.51hint.com/js/photoswipe.min.js"></script>
<script src="https://www.51hint.com/js/auto-render.min.js"></script>
<script src="https://www.51hint.com/js/main.js"></script>
<script src="https://www.51hint.com/js/prism.js"></script>
<script src="https://www.51hint.com/js/katex.min.js"></script>

<script> renderMathInElement(document.body); </script>







  </body>
</html>

