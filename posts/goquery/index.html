<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title> Goquery - </title>
  <meta name="description" content="" />
  <meta property="og:title" content="Goquery" />
  <meta name="twitter:title" content="Goquery" />
  <meta name="description" content="goquery">
  <meta property="og:description" content="goquery">
  <meta name="twitter:description" content="goquery">
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="https://www.51hint.com/posts/goquery/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="IT技术分享" />

  <meta name="generator" content="Hugo 0.81.0" />
  <link rel="canonical" href="https://www.51hint.com/posts/goquery/" />
  <link rel="alternate" href="https://www.51hint.com/index.xml" type="application/rss+xml" title="IT技术分享">
  
  
  <script src="https://www.51hint.com/js/jquery-1.12.4.min.js"></script>
  <link rel="stylesheet" href="https://www.51hint.com/css/katex.min.css" />
  <link rel="stylesheet" href="https://www.51hint.com/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://www.51hint.com/css/bootstrap.min.css" />
  
  
  
  <link rel="stylesheet" href="https://www.51hint.com/css/main.css" />
  
  
  
  



<link rel="stylesheet" href="https://www.51hint.com/css/photoswipe.css" />
<link rel="stylesheet" href="https://www.51hint.com/css/default-skin/default-skin.css" />





<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>




<link rel="stylesheet" href="https://www.51hint.com/css/styles/atom-one-dark.css" />
<script src="https://www.51hint.com/js/highlight.pack.js"></script>

<script>hljs.initHighlightingOnLoad();</script>
</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://www.51hint.com/">IT技术分享</a>
    </div>
    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        

        

        
        
          <li>
            <a id="mSearch" href="#modalSearch" data-toggle="modal" data-target="#modalSearch" style="outline: none;">
              <span class="hidden-sm hidden-md hidden-lg">Search</span> <span id="searchGlyph" class="glyphicon glyphicon-search"></span>
            </a>
          </li>
          
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
      </div>
    </div>

  </div>
</nav>







    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-12 col-md-12 col-md-offset-0">
            <div class="posts-heading">
                <h1 align="center">Goquery</h1>
                
                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>




<div id="fastSearch">
  <input id="searchInput" tabindex="0">
  <ul id="searchResults">
  </ul>
</div>

<script src="/js/fuse.min.js"></script>
<script src="/js/fastsearch.js"></script>
<link rel="stylesheet" href="https://www.51hint.com/css/fast.css" />
    
<div class="container" role="main" itemscope itemtype="http://schema.org/Article">
    <div class="row">
        <div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1">
            
            
              
            <article role="main" class="blog-post" itemprop="articleBody" id="content">
                

                <p>最近研究Go爬虫相关的知识，使用到goquery这个库比较多，尤其是对爬取到的HTML进行选择和查找匹配的内容时，goquery的选择器使用尤其多，而且还有很多不常用但又很有用的选择器，这里总结下，以供参考。</p>
<p>如果大家以前做过前端开发，对jquery不会陌生，goquery类似jquery，它是jquery的go版本实现。使用它，可以很方便的对HTML进行处理。</p>
<blockquote>
<h4 id="goquery-colly--chromedp-webloop">goquery, colly,  chromedp, webloop</h4>
</blockquote>
<h2 id="基于html-element-元素的选择器">基于HTML Element 元素的选择器</h2>
<p>这个比较简单，就是基于<code>a</code>,<code>p</code>等这些HTML的基本元素进行选择，这种直接使用Element名称作为选择器即可。比如<code>dom.Find(&quot;div&quot;)</code>。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">html</span> <span class="o">:=</span> <span class="s">`&lt;body&gt;
</span><span class="s">
</span><span class="s">				&lt;div&gt;DIV1&lt;/div&gt;
</span><span class="s">				&lt;div&gt;DIV2&lt;/div&gt;
</span><span class="s">				&lt;span&gt;SPAN&lt;/span&gt;
</span><span class="s">
</span><span class="s">			&lt;/body&gt;
</span><span class="s">			`</span>

	<span class="nx">dom</span><span class="p">,</span><span class="nx">err</span><span class="o">:=</span><span class="nx">goquery</span><span class="p">.</span><span class="nf">NewDocumentFromReader</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">html</span><span class="p">))</span>
	<span class="k">if</span> <span class="nx">err</span><span class="o">!=</span><span class="kc">nil</span><span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">dom</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="s">&#34;div&#34;</span><span class="p">).</span><span class="nf">Each</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">selection</span> <span class="o">*</span><span class="nx">goquery</span><span class="p">.</span><span class="nx">Selection</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nf">Text</span><span class="p">())</span>
	<span class="p">})</span>
<span class="p">}</span>
</code></pre></div><p>以上示例，可以把<code>div</code>元素筛选出来，而<code>body</code>,<code>span</code>并不会被筛选。</p>
<h2 id="id-选择器">ID 选择器</h2>
<p>这个是使用频次最多的，类似于上面的例子，有两个<code>div</code>元素，其实我们只需要其中的一个，那么我们只需要给这个标记一个唯一的<code>id</code>即可，这样我们就可以使用<code>id</code>选择器，精确定位了。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">html</span> <span class="o">:=</span> <span class="s">`&lt;body&gt;
</span><span class="s">
</span><span class="s">				&lt;div id=&#34;div1&#34;&gt;DIV1&lt;/div&gt;
</span><span class="s">				&lt;div&gt;DIV2&lt;/div&gt;
</span><span class="s">				&lt;span&gt;SPAN&lt;/span&gt;
</span><span class="s">
</span><span class="s">			&lt;/body&gt;
</span><span class="s">			`</span>

	<span class="nx">dom</span><span class="p">,</span><span class="nx">err</span><span class="o">:=</span><span class="nx">goquery</span><span class="p">.</span><span class="nf">NewDocumentFromReader</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">html</span><span class="p">))</span>
	<span class="k">if</span> <span class="nx">err</span><span class="o">!=</span><span class="kc">nil</span><span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">dom</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="s">&#34;#div1&#34;</span><span class="p">).</span><span class="nf">Each</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">selection</span> <span class="o">*</span><span class="nx">goquery</span><span class="p">.</span><span class="nx">Selection</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nf">Text</span><span class="p">())</span>
	<span class="p">})</span>
<span class="p">}</span>
</code></pre></div><h2 id="element-id-选择器">Element ID 选择器</h2>
<p><code>id</code>选择器以<code>#</code>开头，紧跟着元素<code>id</code>的值，使用语法为<code>dom.Find(#id)</code>,后面的例子我会简写为<code>Find(#id)</code>,大家知道这是代表goquery选择器的即可。</p>
<p>如果有相同的ID，但是它们又分别属于不同的HTML元素怎么办？有好办法，和Element结合起来。比如我们筛选元素为<code>div</code>,并且<code>id</code>是<code>div1</code>的元素，就可以使用<code>Find(div#div1)</code>这样的筛选器进行筛选。</p>
<p>所以这类筛选器的语法为<code>Find(element#id)</code>，这是常用的组合方法，比如后面讲的过滤器也可以采用这种方式组合使用。</p>
<h2 id="class选择器">Class选择器</h2>
<p><code>class</code>也是HTML中常用的属性，我们可以通过<code>class</code>选择器来快速的筛选需要的HTML元素，它的用法和<code>ID</code>选择器类似，为<code>Find(&quot;.class&quot;)</code>。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">html</span> <span class="o">:=</span> <span class="s">`&lt;body&gt;
</span><span class="s">
</span><span class="s">				&lt;div id=&#34;div1&#34;&gt;DIV1&lt;/div&gt;
</span><span class="s">				&lt;div class=&#34;name&#34;&gt;DIV2&lt;/div&gt;
</span><span class="s">				&lt;span&gt;SPAN&lt;/span&gt;
</span><span class="s">
</span><span class="s">			&lt;/body&gt;
</span><span class="s">			`</span>

	<span class="nx">dom</span><span class="p">,</span><span class="nx">err</span><span class="o">:=</span><span class="nx">goquery</span><span class="p">.</span><span class="nf">NewDocumentFromReader</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">html</span><span class="p">))</span>
	<span class="k">if</span> <span class="nx">err</span><span class="o">!=</span><span class="kc">nil</span><span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">dom</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="s">&#34;.name&#34;</span><span class="p">).</span><span class="nf">Each</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">selection</span> <span class="o">*</span><span class="nx">goquery</span><span class="p">.</span><span class="nx">Selection</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nf">Text</span><span class="p">())</span>
	<span class="p">})</span>
<span class="p">}</span>
</code></pre></div><p>以上示例中，就筛选出来<code>class</code>为<code>name</code>的这个<code>div</code>元素。</p>
<h2 id="element-class-选择器">Element Class 选择器</h2>
<p><code>class</code>选择器和<code>id</code>选择器一样，也可以结合着HTML元素使用，他们的语法也类似<code>Find(element.class)</code>，这样就可以筛选特定element、并且指定class的元素。</p>
<h2 id="属性选择器">属性选择器</h2>
<p>一个HTML元素都有自己的属性以及属性值，所以我们也可以通过属性和值筛选元素。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">html</span> <span class="o">:=</span> <span class="s">`&lt;body&gt;
</span><span class="s">
</span><span class="s">				&lt;div&gt;DIV1&lt;/div&gt;
</span><span class="s">				&lt;div class=&#34;name&#34;&gt;DIV2&lt;/div&gt;
</span><span class="s">				&lt;span&gt;SPAN&lt;/span&gt;
</span><span class="s">
</span><span class="s">			&lt;/body&gt;
</span><span class="s">			`</span>

	<span class="nx">dom</span><span class="p">,</span><span class="nx">err</span><span class="o">:=</span><span class="nx">goquery</span><span class="p">.</span><span class="nf">NewDocumentFromReader</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">html</span><span class="p">))</span>
	<span class="k">if</span> <span class="nx">err</span><span class="o">!=</span><span class="kc">nil</span><span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">dom</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="s">&#34;div[class]&#34;</span><span class="p">).</span><span class="nf">Each</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">selection</span> <span class="o">*</span><span class="nx">goquery</span><span class="p">.</span><span class="nx">Selection</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nf">Text</span><span class="p">())</span>
	<span class="p">})</span>
<span class="p">}</span>
</code></pre></div><p>示例中我们通过<code>div[class]</code>这个选择器，筛选出Element为<code>div</code>并且有<code>class</code>这个属性的，所以第一个<code>div</code>没有被筛选到。</p>
<p>刚刚上面这个示例是采用是否存在某个属性为筛选器，同理，我们可以筛选出属性为某个值的元素。</p>
<pre><code>    dom.Find(&quot;div[class=name]&quot;).Each(func(i int, selection *goquery.Selection) {
		fmt.Println(selection.Text())
	})
</code></pre><p>这样我们就可以筛选出<code>class</code>这个属性值为<code>name</code>的<code>div</code>元素。</p>
<p>当然我们这里以<code>class</code>属性为例，还可以用其他属性，比如<code>href</code>等很多，自定义属性也是可以的。</p>
<p>除了完全相等，还有其他匹配方式，使用方式类似，这里统一列举下，不再举例</p>
<table>
<thead>
<tr>
<th style="text-align:left">选择器</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Find(“div[lang]“)</td>
<td style="text-align:left">筛选含有lang属性的div元素</td>
</tr>
<tr>
<td style="text-align:left">Find(“div[lang=zh]“)</td>
<td style="text-align:left">筛选lang属性为zh的div元素</td>
</tr>
<tr>
<td style="text-align:left">Find(“div[lang!=zh]“)</td>
<td style="text-align:left">筛选lang属性不等于zh的div元素</td>
</tr>
<tr>
<td style="text-align:left">Find(“div[lang¦=zh]“)</td>
<td style="text-align:left">筛选lang属性为zh或者zh-开头的div元素</td>
</tr>
<tr>
<td style="text-align:left">Find(“div[lang*=zh]“)</td>
<td style="text-align:left">筛选lang属性包含zh这个字符串的div元素</td>
</tr>
<tr>
<td style="text-align:left">Find(“div[lang~=zh]“)</td>
<td style="text-align:left">筛选lang属性包含zh这个单词的div元素，单词以空格分开的</td>
</tr>
<tr>
<td style="text-align:left">Find(“div[lang$=zh]“)</td>
<td style="text-align:left">筛选lang属性以zh结尾的div元素，区分大小写</td>
</tr>
<tr>
<td style="text-align:left">Find(“div[lang^=zh]“)</td>
<td style="text-align:left">筛选lang属性以zh开头的div元素，区分大小写</td>
</tr>
</tbody>
</table>
<p>以上是属性筛选器的用法，都是以一个属性筛选器为例，当然你也可以使用多个属性筛选器组合使用，比如：<code>Find(&quot;div[id][lang=zh]&quot;)</code>,用多个中括号连起来即可。当有多个属性筛选器的时候，要同时满足这些筛选器的元素才能被筛选出来。</p>
<h2 id="parentchild选择器">parent&gt;child选择器</h2>
<p>如果我们想筛选出某个元素下符合条件的子元素，我们就可以使用子元素筛选器，它的语法为<code>Find(&quot;parent&gt;child&quot;)</code>,表示筛选parent这个父元素下，符合child这个条件的最直接（一级）的子元素。</p>
<pre><code>func main() {
	html := `&lt;body&gt;

				&lt;div lang=&quot;ZH&quot;&gt;DIV1&lt;/div&gt;
				&lt;div lang=&quot;zh-cn&quot;&gt;DIV2&lt;/div&gt;
				&lt;div lang=&quot;en&quot;&gt;DIV3&lt;/div&gt;
				&lt;span&gt;
					&lt;div&gt;DIV4&lt;/div&gt;
				&lt;/span&gt;

			&lt;/body&gt;
			`

	dom,err:=goquery.NewDocumentFromReader(strings.NewReader(html))
	if err!=nil{
		log.Fatalln(err)
	}

	dom.Find(&quot;body&gt;div&quot;).Each(func(i int, selection *goquery.Selection) {
		fmt.Println(selection.Text())
	})
}
</code></pre><p>以上示例，筛选出<code>body</code>这个父元素下，符合条件的最直接的子元素<code>div</code>，结果是<code>DIV1、DIV2、DIV3</code>，虽然<code>DIV4</code>也是<code>body</code>的子元素，但不是一级的，所以不会被筛选到。</p>
<p>那么问题来了，我就是想把<code>DIV4</code>也筛选出来怎么办?就是要筛选<code>body</code>下所有的<code>div</code>元素，不管是一级、二级还是N级。有办法的，goquery考虑到了，只需要把大于号(<code>&gt;</code>)改为空格就好了。比如上面的例子，改为如下选择器即可。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go">    <span class="nx">dom</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="s">&#34;body div&#34;</span><span class="p">).</span><span class="nf">Each</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">selection</span> <span class="o">*</span><span class="nx">goquery</span><span class="p">.</span><span class="nx">Selection</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nf">Text</span><span class="p">())</span>
	<span class="p">})</span>
</code></pre></div><h2 id="prevnext相邻选择器">prev+next相邻选择器</h2>
<p>假设我们要筛选的元素没有规律，但是该元素的上一个元素有规律，我们就可以使用这种下一个相邻选择器来进行选择。</p>
<pre><code>func main() {
	html := `&lt;body&gt;

				&lt;div lang=&quot;zh&quot;&gt;DIV1&lt;/div&gt;
				&lt;p&gt;P1&lt;/p&gt;
				&lt;div lang=&quot;zh-cn&quot;&gt;DIV2&lt;/div&gt;
				&lt;div lang=&quot;en&quot;&gt;DIV3&lt;/div&gt;
				&lt;span&gt;
					&lt;div&gt;DIV4&lt;/div&gt;
				&lt;/span&gt;
				&lt;p&gt;P2&lt;/p&gt;

			&lt;/body&gt;
			`

	dom,err:=goquery.NewDocumentFromReader(strings.NewReader(html))
	if err!=nil{
		log.Fatalln(err)
	}

	dom.Find(&quot;div[lang=zh]+p&quot;).Each(func(i int, selection *goquery.Selection) {
		fmt.Println(selection.Text())
	})
}
</code></pre><p>这个示例演示了这种用法，我们想选择<code>&lt;p&gt;P1&lt;/p&gt;</code>这个元素，但是没啥规律，我们发现它前面的<code>&lt;div lang=&quot;zh&quot;&gt;DIV1&lt;/div&gt;</code>很有规律，可以选择，所以我们就可以采用<code>Find(&quot;div[lang=zh]+p&quot;)</code>达到选择<code>P</code>元素的目的。</p>
<p>这种选择器的语法是<code>(&quot;prev+next&quot;)</code>，中间是一个加号(+)，+号前后也是选择器。</p>
<blockquote>
<p>本文为原创文章，转载注明出处，欢迎扫码关注公众号<code>flysnow_org</code>或者网站<a href="http://www.flysnow.org/">http://www.flysnow.org/</a>，第一时间看后续精彩文章。一些比较可耻的网站抓取我的文章会去掉版权信息，这里再写一段，大家见谅。</p>
</blockquote>
<h2 id="prevnext选择器">prev~next选择器</h2>
<p>有相邻就有兄弟，兄弟选择器就不一定要求相邻了，只要他们共有一个父元素就可以。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go">	<span class="nx">dom</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="s">&#34;div[lang=zh]~p&#34;</span><span class="p">).</span><span class="nf">Each</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">selection</span> <span class="o">*</span><span class="nx">goquery</span><span class="p">.</span><span class="nx">Selection</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nf">Text</span><span class="p">())</span>
	<span class="p">})</span>
</code></pre></div><p>刚刚的例子，只需要把<code>+</code>号换成<code>~</code>号,就可以把<code>P2</code>也筛选出来，因为<code>P2</code>、<code>P1</code>和<code>DIV1</code>都是兄弟。</p>
<p>兄弟选择器的语法是<code>(&quot;prev~next&quot;)</code>,也就是相邻选择器的<code>+</code>换成了<code>~</code>。</p>
<h2 id="内容过滤器">内容过滤器</h2>
<p>有时候我们使用选择器选择出来后后，希望再过滤一下，这时候就用到过滤器了，过滤器有很多，我们先讲内容过滤器这一种。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go">	<span class="nx">dom</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="s">&#34;div:contains(DIV2)&#34;</span><span class="p">).</span><span class="nf">Each</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">selection</span> <span class="o">*</span><span class="nx">goquery</span><span class="p">.</span><span class="nx">Selection</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nf">Text</span><span class="p">())</span>
	<span class="p">})</span>
</code></pre></div><p><code>Find(&quot;:contains(text)&quot;)</code>表示筛选出的元素要包含指定的文本，我们例子中要求选择出的<code>div</code>元素要包含<code>DIV2</code>文本，那么只有一个<code>DIV2</code>元素满足要求。</p>
<p>此外还有<code>Find(&quot;:empty&quot;)</code>表示筛选出的元素都不能有子元素（包括文本元素），只筛选那些不包含任何子元素的元素。</p>
<p><code>Find(&quot;:has(selector)&quot;)</code>和<code>contains</code>差不多，只不过这个是包含的是元素节点。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go">    <span class="nx">dom</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="s">&#34;span:has(div)&#34;</span><span class="p">).</span><span class="nf">Each</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">selection</span> <span class="o">*</span><span class="nx">goquery</span><span class="p">.</span><span class="nx">Selection</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nf">Text</span><span class="p">())</span>
	<span class="p">})</span>
</code></pre></div><p>以上示例表示筛选出包含<code>div</code>元素的<code>span</code>节点。</p>
<h2 id="first-child过滤器">:first-child过滤器</h2>
<p><code>:first-child</code>过滤器，语法为<code>Find(&quot;:first-child&quot;)</code>，表示筛选出的元素要是他们的父元素的第一个子元素，如果不是，则不会被筛选出来。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">html</span> <span class="o">:=</span> <span class="s">`&lt;body&gt;
</span><span class="s">
</span><span class="s">				&lt;div lang=&#34;zh&#34;&gt;DIV1&lt;/div&gt;
</span><span class="s">				&lt;p&gt;P1&lt;/p&gt;
</span><span class="s">				&lt;div lang=&#34;zh-cn&#34;&gt;DIV2&lt;/div&gt;
</span><span class="s">				&lt;div lang=&#34;en&#34;&gt;DIV3&lt;/div&gt;
</span><span class="s">				&lt;span&gt;
</span><span class="s">					&lt;div style=&#34;display:none;&#34;&gt;DIV4&lt;/div&gt;
</span><span class="s">					&lt;div&gt;DIV5&lt;/div&gt;
</span><span class="s">				&lt;/span&gt;
</span><span class="s">				&lt;p&gt;P2&lt;/p&gt;
</span><span class="s">				&lt;div&gt;&lt;/div&gt;
</span><span class="s">
</span><span class="s">			&lt;/body&gt;
</span><span class="s">			`</span>

	<span class="nx">dom</span><span class="p">,</span><span class="nx">err</span><span class="o">:=</span><span class="nx">goquery</span><span class="p">.</span><span class="nf">NewDocumentFromReader</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">html</span><span class="p">))</span>
	<span class="k">if</span> <span class="nx">err</span><span class="o">!=</span><span class="kc">nil</span><span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">dom</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="s">&#34;div:first-child&#34;</span><span class="p">).</span><span class="nf">Each</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">selection</span> <span class="o">*</span><span class="nx">goquery</span><span class="p">.</span><span class="nx">Selection</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nf">Html</span><span class="p">())</span>
	<span class="p">})</span>
<span class="p">}</span>
</code></pre></div><p>以上例子中，我们使用<code>Find(&quot;div&quot;)</code>会筛选出所有的<code>div</code>元素，但是我们加了<code>:first-child</code>后，就只有<code>DIV1</code>和<code>DIV4</code>了，因为只有这两个是他们父元素的第一个子元素，其他的<code>DIV</code>都不满足。</p>
<h2 id="first-of-type过滤器">:first-of-type过滤器</h2>
<p><code>:first-child</code>选择器限制的比较死，必须得是第一个子元素，如果该元素前有其他在前面，就不能用<code>:first-child</code>了，这时候<code>:first-of-type</code>就派上用场了，它要求只要是这个类型的第一个就可以，我们把上面的例子微调下。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">html</span> <span class="o">:=</span> <span class="s">`&lt;body&gt;
</span><span class="s">
</span><span class="s">				&lt;div lang=&#34;zh&#34;&gt;DIV1&lt;/div&gt;
</span><span class="s">				&lt;p&gt;P1&lt;/p&gt;
</span><span class="s">				&lt;div lang=&#34;zh-cn&#34;&gt;DIV2&lt;/div&gt;
</span><span class="s">				&lt;div lang=&#34;en&#34;&gt;DIV3&lt;/div&gt;
</span><span class="s">				&lt;span&gt;
</span><span class="s">					&lt;p&gt;P2&lt;/p&gt;
</span><span class="s">					&lt;div&gt;DIV5&lt;/div&gt;
</span><span class="s">				&lt;/span&gt;
</span><span class="s">				&lt;div&gt;&lt;/div&gt;
</span><span class="s">
</span><span class="s">			&lt;/body&gt;
</span><span class="s">			`</span>

	<span class="nx">dom</span><span class="p">,</span><span class="nx">err</span><span class="o">:=</span><span class="nx">goquery</span><span class="p">.</span><span class="nf">NewDocumentFromReader</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">html</span><span class="p">))</span>
	<span class="k">if</span> <span class="nx">err</span><span class="o">!=</span><span class="kc">nil</span><span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">dom</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="s">&#34;div:first-of-type&#34;</span><span class="p">).</span><span class="nf">Each</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">selection</span> <span class="o">*</span><span class="nx">goquery</span><span class="p">.</span><span class="nx">Selection</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nf">Html</span><span class="p">())</span>
	<span class="p">})</span>
<span class="p">}</span>
</code></pre></div><p>改动很简单，把原来的<code>DIV4</code>换成了<code>P2</code>，如果我们还使用<code>:first-child</code>,<code>DIV5</code>是不能被筛选出来的，因为它不是第一个子元素，它前面还有一个<code>P2</code>。这时候我们使用<code>:first-of-type</code>就可以达到目的，因为它要求是同类型第一个就可以。<code>DIV5</code>就是这个<code>div</code>类型的第一个元素，<code>P2</code>不是<code>div</code>类型，被忽略。</p>
<h2 id="last-child-和-last-of-type过滤器">:last-child 和 :last-of-type过滤器</h2>
<p>这两个正好和上面的<code>:first-child</code>、<code>:first-of-type</code>相反，表示最后一个，这里不再举例，大家可以自己试试。</p>
<h2 id="nth-childn-过滤器">:nth-child(n) 过滤器</h2>
<p>这个表示筛选出的元素是其父元素的第n个元素，n以1开始。所以我们可以知道<code>:first-child</code>和<code>:nth-child(1)</code>是相等的。通过指定<code>n</code>，我们就很灵活的筛选出我们需要的元素。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">html</span> <span class="o">:=</span> <span class="s">`&lt;body&gt;
</span><span class="s">
</span><span class="s">				&lt;div lang=&#34;zh&#34;&gt;DIV1&lt;/div&gt;
</span><span class="s">				&lt;p&gt;P1&lt;/p&gt;
</span><span class="s">				&lt;div lang=&#34;zh-cn&#34;&gt;DIV2&lt;/div&gt;
</span><span class="s">				&lt;div lang=&#34;en&#34;&gt;DIV3&lt;/div&gt;
</span><span class="s">				&lt;span&gt;
</span><span class="s">					&lt;p&gt;P2&lt;/p&gt;
</span><span class="s">					&lt;div&gt;DIV5&lt;/div&gt;
</span><span class="s">				&lt;/span&gt;
</span><span class="s">				&lt;div&gt;&lt;/div&gt;
</span><span class="s">
</span><span class="s">			&lt;/body&gt;
</span><span class="s">			`</span>

	<span class="nx">dom</span><span class="p">,</span><span class="nx">err</span><span class="o">:=</span><span class="nx">goquery</span><span class="p">.</span><span class="nf">NewDocumentFromReader</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">html</span><span class="p">))</span>
	<span class="k">if</span> <span class="nx">err</span><span class="o">!=</span><span class="kc">nil</span><span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">dom</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="s">&#34;div:nth-child(3)&#34;</span><span class="p">).</span><span class="nf">Each</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">selection</span> <span class="o">*</span><span class="nx">goquery</span><span class="p">.</span><span class="nx">Selection</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nf">Html</span><span class="p">())</span>
	<span class="p">})</span>
<span class="p">}</span>
</code></pre></div><p>这个示例会筛选出<code>DIV2</code>，因为<code>DIV2</code>是其父元素<code>body</code>的第三个子元素。</p>
<h2 id="nth-of-typen-过滤器">:nth-of-type(n) 过滤器</h2>
<p><code>:nth-of-type(n)</code>和 <code>:nth-child(n)</code> 类似，只不过它表示的是同类型元素的第n个,所以<code>:nth-of-type(1)</code> 和 <code>:first-of-type</code>是相等的，大家可以自己试试，这里不再举例。</p>
<h2 id="nth-last-childn-和nth-last-of-typen-过滤器">nth-last-child(n) 和:nth-last-of-type(n) 过滤器</h2>
<p>这两个和上面的类似，只不过是倒序开始计算的，最后一个元素被当成了第一个。大家自己测试下看看效果，很明显。</p>
<h2 id="only-child-过滤器">:only-child 过滤器</h2>
<p><code>Find(&quot;:only-child&quot;)</code> 过滤器，从字面上看，可以猜测出来，它表示筛选的元素，在其父元素中，只有它自己，它的父元素没有其他子元素，才会被匹配筛选出来。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">html</span> <span class="o">:=</span> <span class="s">`&lt;body&gt;
</span><span class="s">				&lt;div lang=&#34;zh&#34;&gt;DIV1&lt;/div&gt;
</span><span class="s">				&lt;span&gt;
</span><span class="s">					&lt;div&gt;DIV5&lt;/div&gt;
</span><span class="s">				&lt;/span&gt;
</span><span class="s">
</span><span class="s">			&lt;/body&gt;
</span><span class="s">			`</span>

	<span class="nx">dom</span><span class="p">,</span><span class="nx">err</span><span class="o">:=</span><span class="nx">goquery</span><span class="p">.</span><span class="nf">NewDocumentFromReader</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">html</span><span class="p">))</span>
	<span class="k">if</span> <span class="nx">err</span><span class="o">!=</span><span class="kc">nil</span><span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">dom</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="s">&#34;div:only-child&#34;</span><span class="p">).</span><span class="nf">Each</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">selection</span> <span class="o">*</span><span class="nx">goquery</span><span class="p">.</span><span class="nx">Selection</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nf">Html</span><span class="p">())</span>
	<span class="p">})</span>
<span class="p">}</span>
</code></pre></div><p>示例中<code>DIV5</code>就可以被筛选出来，因为它是它的父元素<code>span</code>达到唯一子元素，但<code>DIV1</code>就不是，所以不能呗筛选出来。</p>
<h2 id="only-of-type-过滤器">:only-of-type 过滤器</h2>
<p>上面的例子，如果想筛选出<code>DIV1</code>怎么办？可以使用<code>Find(&quot;:only-of-type&quot;)</code>,因为它是它的父元素中，唯一的<code>div</code>元素，这就是<code>:only-of-type</code>过滤器所要做的，同类型元素只要只有一个，就可以被筛选出来。大家把上面的例子改成<code>:only-of-type</code>试试，看看是否有<code>DIV1</code>。</p>
<h2 id="选择器或运算">选择器或(|)运算</h2>
<p>如果我们想同时筛选出<code>div</code>,<code>span</code>等元素怎么办？这时候可以采用多个选择器进行组合使用，并且以逗号(,)分割，<code>Find(&quot;selector1, selector2, selectorN&quot;)</code>表示，只要满足其中一个选择器就可以被筛选出来，也就是选择器的或(|)运算操作。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">html</span> <span class="o">:=</span> <span class="s">`&lt;body&gt;
</span><span class="s">				&lt;div lang=&#34;zh&#34;&gt;DIV1&lt;/div&gt;
</span><span class="s">				&lt;span&gt;
</span><span class="s">					&lt;div&gt;DIV5&lt;/div&gt;
</span><span class="s">				&lt;/span&gt;
</span><span class="s">
</span><span class="s">			&lt;/body&gt;
</span><span class="s">			`</span>

	<span class="nx">dom</span><span class="p">,</span><span class="nx">err</span><span class="o">:=</span><span class="nx">goquery</span><span class="p">.</span><span class="nf">NewDocumentFromReader</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">html</span><span class="p">))</span>
	<span class="k">if</span> <span class="nx">err</span><span class="o">!=</span><span class="kc">nil</span><span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">dom</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="s">&#34;div,span&#34;</span><span class="p">).</span><span class="nf">Each</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">selection</span> <span class="o">*</span><span class="nx">goquery</span><span class="p">.</span><span class="nx">Selection</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nf">Html</span><span class="p">())</span>
	<span class="p">})</span>
<span class="p">}</span>
</code></pre></div><h2 id="小结">小结</h2>
<p>goquery 是解析HTML网页必备的利器，在爬虫抓取网页的过程中，灵活的使用goquery不同的选择器，可以让我们的抓取工作事半功倍，大大提升爬虫的效率。</p>

            </article>

            <ul class="pager blog-pager">
                
                <li class="previous">
                    <a href="https://www.51hint.com/posts/newsql/" data-toggle="tooltip" data-placement="top" title="Newsql">&larr; Previous Post</a>
                </li>
                 
                <li class="next">
                    <a href="https://www.51hint.com/posts/apigateway/" data-toggle="tooltip" data-placement="top" title="ApiGateway">Next Post &rarr;</a>
                </li>
                
            </ul>
            
            <div>
                 
                <h2>See Also</h2>
                <ul>
                    
                    <li><a href="/posts/newsql/">Newsql</a></li>
                    
                    <li><a href="/posts/consul_zipkin_etcd/">Consul_zipkin_etcd</a></li>
                    
                    <li><a href="/posts/go_mysql%E6%97%B6%E5%8C%BA/">Go_mysql时区</a></li>
                    
                    <li><a href="/posts/ceph%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F/">Ceph分布式存储系统</a></li>
                    
                    <li><a href="/posts/etcd%E5%AE%89%E8%A3%85/">Etcd安装</a></li>
                    
                </ul>
                
            </div>
            
            
            
              
            </div>
            
            
        </div>
    </div>
    </section>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
        
          
          
        </ul>
        <p class="credits copyright text-muted">
        &copy;2017-2018
          
          
          
            &nbsp;&bull;&nbsp;
            <a href="https://www.51hint.com/">IT技术分享</a>
          
        </p>
        <p class="credits theme-by text-muted">
          
        </p>

        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.81.0</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/rootsongjc/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>




<script src="https://www.51hint.com/js/bootstrap.min.js"></script>
<script src="https://www.51hint.com/js/photoswipe-ui-default.min.js"></script>
<script src="https://www.51hint.com/js/photoswipe.min.js"></script>
<script src="https://www.51hint.com/js/auto-render.min.js"></script>
<script src="https://www.51hint.com/js/main.js"></script>
<script src="https://www.51hint.com/js/prism.js"></script>
<script src="https://www.51hint.com/js/katex.min.js"></script>

<script> renderMathInElement(document.body); </script>







  </body>
</html>

